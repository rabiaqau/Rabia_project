import os
import glob

def run_file( filename ):
    print "Processing", filename
    os.system( "python2 emittance_analysis_neo.py " + filename )

from multiprocessing import Pool
pool = Pool(16)

run_list = set( [364292, 364098,364030,363830,363710,
                 348354, 348354, 348403, 348403, 348495,
                 348495, 348495, 348511, 348511, 348534,
                 348534, 348534, 348534, 348534, 348534,
                 348609, 348610, 348618, 348618, 348836,
                 348836, 348885,348885, 348885, 348894,
                 348895, 349011, 349011, 349014, 349014,
                 349033, 349033, 349051, 349051, 349111,
                 349114, 349114, 349169,349169, 349268,
                 349268, 349309, 349327, 349335, 349451,
                 349451,])
                 # 349481, 349481,  349526, 349533, 349534, 349582,
                 # 349592, 349637, 349637, 349646, 349693, 349693, 349841, 349842,
                 # 349944, 349944, 349977, 350013, 350013, 350067, 350121, 350121,
                 # 350144, 350144, 350160, 350160, 350184, 350184, 350220, 350310,
                 # 350310, 350361, 350361, 350440, 350440, 350479, 350479, 350531,
                 # 350531, 350676, 350676, 350676, 350676, 350676, 350676, 350682,
                 # 350682, 350842, 350880, 350880, 350880, 351062, 351223, 351223,
                 # 351364, 351364, 351550, 351628, 351671, 351671, 351969, 351969,
                 # 352107, 352274, 352394, 352394, 352448, 352448, 354071, 354124,
                 # 354359, 354396, 354494, 354826, 354826, 354863, 354893, 354944,
                 # 354944, 355008, 355008, 355053, 355109, 355109, 355181, 355224,
                 # 355224, 355261, 355261, 355331, 355331, 355389, 355416,
                 # 355446, 355446, 355446, 355468, 355468, 355529, 355544, 355754,
                 # 355754, 355995, 355995, 356177, 356250, 357193,
                 # 357193, 357283, 357409, 357409, 357451, 357500, 357539, 357620,
                 # 357620, 357679, 357713, 357713, 357772, 357821, 357887, 357887,
                 # 358031, 358031, 358115, 358215, 358300, 358395, 358395, 358516,
                 # 358541, 358541, 358615, 358615, 358656, 358985, 359058, 359124,
                 # 359170, 359171, 359191, 359191, 359286, 359310, 359355, 359472,
                 # 359541, 359541, 359593, 359678, 359717, 359735, 359735, 359823,
                 # 359823, 359872, 359918, 360026, 360063, 360161, 360209, 360244,
                 # 360293, 360309, 360309, 360402, 360414, 361738, 361738, 361795,
                 # 361862, 361862, 362354, 362445, 362445, 362552, 362661,
                 # 362661, 362776, 363033, 363033, 363129, 363198, 363198, 363400,
                 # 363438, 363438, 363438, 363516, 363664, 363710, 363710, 363738,
                 # 363830, 363830, 363910, 363947, 363979, 364030, 364030, 364076,
                 # 364098, 364098, 364214, 364292, 364292])

# run_list = set( [ 
#         364292,
#         364292,
#         364214,
#         364098,
#         364098,
#         364076,
#         364030,
#         364030,
#         363979,
#         363947,
#         363910,
#         363830,
#         363830,
#         363738,
#         363710,
#         363710,
#         363400,
#         363198,
#         360026,
#         359918,
#         359872,
#         359472,
#         359355,
#         359310,
#         359286,
#         359191,
#         359191,
#         359171,
#         359170,
#         359124,
#         359058,
#         358985,
#         358656,
#         358615,
#         358615,
#         358541,
#         358541,
#         358516,
#         358395,
#         358395,
#         358300,
#         358215,
#         358115,
#         358031
#         ])


files = []
for run in run_list:
    file_list = glob.glob("/eos/atlas/atlascerngroupdisk/data-prep/lumi_track_counting/HistFiles/TCLUMI2018_FALL18/*"+str(run)+"*/*HIST*")
    print file_list
    if len( file_list ):
        files.append( file_list[-1] )

print files

out = pool.map( run_file, files )



